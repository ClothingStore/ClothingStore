{% extends 'front/base.html' %}
	<!-- 顶部标题 -->
{% block body %}
	<div class="bgf5 clearfix">
		<div class="top-user">
			<div class="inner">
				<a class="logo" href="{% url 'front:index' %}"><img src="/static/images/icons/logo.jpg" alt="U袋网" class="cover"></a>
				<div class="title">收货地址</div>
			</div>
		</div>
	</div>
	<div class="content clearfix bgf5">
		<section class="user-center inner clearfix">
			<div class="pull-left bgf">
				<a href="{% url 'front:welcome' %}" class="title">欢迎页</a>
				<dl class="user-center__nav">
					<dt>帐户信息</dt>
					<a href="{% url 'front:udaisetting' %}"><dd>个人资料</dd></a>
					<a href=""><dd>积分平台</dd></a>
					<a href="{% url 'front:address' %}"><dd class="active">收货地址</dd></a>
					<a href=""><dd>修改登录密码</dd></a>
				</dl>
				<dl class="user-center__nav">
					<dt>订单中心</dt>
					<a href="{% url 'front:userorder' %}"><dd>我的订单</dd></a>
                    <a href=""><dd>我的收藏</dd></a>
					<a href=""><dd>退款/退货</dd></a>
				</dl>
			</div>
			<div class="pull-right">
                {% block edit %}
				<div class="user-content__box clearfix bgf">
					<div class="title">账户信息-收货地址</div>
					<form action="{% url 'front:address' %}" class="user-addr__form form-horizontal" method="post">
                        {% csrf_token %}
						<p class="fz18 cr">新增收货地址</p>
						<div class="form-group">
							<label for="name" class="col-sm-2 control-label">收货人姓名：</label>
							<div class="col-sm-6">
								<input class="form-control" id="name" placeholder="请输入姓名" type="text" name="conname"><font color="red">{{ form.conname.errors }}</font>
							</div>
						</div>
						<div class="form-group">
							<label for="details" class="col-sm-2 control-label">收货地址：</label>
							<div class="col-sm-10">
								<div class="addr-linkage">
									<select name="province"></select>
									<select name="city"></select>
									<select name="area"></select>
									<select name="town"></select>
								</div>
								<input class="form-control" id="details" placeholder="建议您如实填写详细收货地址，例如街道名称，门牌号码等信息" maxlength="32" type="text" name="particulars">
                                <font color="red">{{ form.particulars.errors }}</font>
							</div>
						</div>
						<div class="form-group">
							<label for="mobile" class="col-sm-2 control-label" >手机号码：</label>
							<div class="col-sm-6">
								<input class="form-control"  name="telephone" id="mobile" placeholder="请输入手机号码" type="text"><font color="red">{{ form.telephone.errors }}</font>
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-2 col-sm-6">
								<div class="checkbox">
									<label><input  type="checkbox" checked name="default"><i></i> 设为默认收货地址</label>
								</div>
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-2 col-sm-6">
								<button type="submit" class="but">保存</button>
							</div>
						</div>
						<script src="/static/js/jquery.citys.js"></script>
						<script>
							$(document).ready(function(){
								// 添加街道/乡镇
								function townFormat(info){
									$('.addr-linkage select[name="town"]').hide().empty();
									if (info['code'] % 1e4 && info['code'] < 7e6){	//是否为“区”且不是港澳台地区
										var ajaxConfig = {
											url: 'http://passer-by.com/data_location/town/' + info['code'] + '.json',
											scriptCharset:'UTF-8',
											dataType: "json",
											timeout: 4000,
											success: function(data) {
												$('.addr-linkage select[name="town"]').show();
												// $('#code').val(info['code']) // 填地区编码
												for (i in data) {
													$('.addr-linkage select[name="town"]').append(
														'<option value="' + data[i] + '">' + data[i] + '</option>'
													);
												};
												$('.addr-linkage select[name="town"]').find('option[value="请选择"]').prop("selected", "selected");
											},
										};
										$.ajax(ajaxConfig).fail(function(p1,p2,p3){
											ajaxConfig.url = 'js/data_location/town/' + info['code'] + '.json';
											$.ajax(ajaxConfig)
										});
									}
								};
								$('.addr-linkage').citys({
									// 如果某天这个仓库地址失效了dataUrl请使用本地 2017.10 的数据 'js/data_location/list.json'
									dataUrl: 'http://passer-by.com/data_location/list.json',
									spareUrl: 'js/data_location/list.json',
									dataType: 'json',
									valueType: 'name',
									province: '请选择',
									city:'请选择',
									area: '请选择',
									onChange: function(data) {
										townFormat(data)
									},
								},function(api){
									var info = api.getInfo();
									townFormat(info);
								});
							});
						</script>
					</form>
					<p class="fz18 cr">已保存的有效地址</p>

					<div class="table-thead addr-thead">
						<div class="tdf1">收货人</div>
						<div class="tdf2">所在地</div>
						<div class="tdf3"><div class="tdt-a_l">详细地址</div></div>
						<!-- <div class="tdf1">邮编</div> -->
						<div class="tdf1">电话/手机</div>
						<div class="tdf1">操作</div>
						<div class="tdf1"></div>
					</div>
					<div class="addr-list">
                        {% for ares in address %}
						<div class="addr-item">
							<div class="tdf1">{{ ares.conname }}</div>
							<div class="tdf2 tdt-a_l">{{ ares.address }}</div>
							<div class="tdf3 tdt-a_l">{{ ares.particulars }}</div>
							<!-- <div class="tdf1">350111</div> -->
							<div class="tdf1">{{ ares.telephone }}</div>
							<div class="tdf1 order">
								<a href="{% url 'front:edit' ares.id %}">修改</a><a href="{% url 'front:edit' ares.id %}?isdel=1">删除</a>
							</div>
							<div class="tdf1">
                                {% if ares.is_default == 1 %}
								<a href="" class="">取消默认</a>
                                {% else %}
                                <a href="" class="">默认地址</a>
                                {% endif %}
							</div>
						</div>
                        {% endfor %}
					</div>
				</div>
                {% endblock %}
            </div>

		</section>
	</div>
	<!-- 右侧菜单 -->
{% endblock %}